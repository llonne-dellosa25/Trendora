<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product Listing</title>

  <!--Bootstrap 5 Only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!--Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <!--Filter Icon-->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=filter_list" />
    <!--External CSS -->
    <link rel="stylesheet" href="style.css" />
</head>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const cartIcon = document.getElementById("cartIcon");
    const cartOverlay = document.getElementById("cartOverlay");
    const closeCart = document.getElementById("closeCart");

    cartIcon.addEventListener("click", () => {
      cartOverlay.style.display = "block";
    });

    closeCart.addEventListener("click", () => {
      cartOverlay.style.display = "none";
    });

    // Optional: Click outside the cart to close
    window.addEventListener("click", function (e) {
      if (e.target === cartOverlay) {
        cartOverlay.style.display = "none";
      }
    });
  });
</script>

<body>
  <!-- Search Header -->
  <div class="header">
    <nav class="top-bar fixed-top">
      <div class="logo">TRENDORA</div>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Jeans for Teens">
      <button><i class="fas fa-search"></i></button>
    </div>
    <div class="icons">
      <div class="icon">
        <a href="customer.html" aria-label="Go to account" style="color: white;">
          <i class="fas fa-user"></i>
        </a>
      </div>
      <div class="icon" id="cartIcon">
        <i class="fa-solid fa-bag-shopping"></i>
        <span class="cart-count">0</span>
      </div>
      <div class="icon" id="cartIcon">
        <a href="javascript:void(0);" id="logout-link" title="Logout" style="color: white;">
            <i class="fas fa-sign-out-alt"></i>
        </a>
      </div>
    </div>
  </div>
    </nav>
    <!-- Cart Overlay -->
    <div class="cart-overlay" id="cartOverlay">
      <div class="cart-content">
        <button class="close-cart" id="closeCart">&times;</button>
    
        <!-- Shopping Cart Simplified -->
        <div class="container my-1">
          <h2 class="mb-4">ALL ITEMS</h2>
          <table class="table table-bordered text-center align-middle">
            <thead class="table-dark">
              <tr>
                <th><input type="checkbox" id="selectAllCheckbox" /></th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Total Price</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="cartItemsContainer">
              <!-- JS will render cart items here -->
            </tbody>
          </table>
    
          <div class="text-end mt-4">
            <h4>Total: â‚±0.00</h4>
            <a href="checkout.html" class="btn btn-success mt-2">Proceed to Checkout</a>
          </div>
        </div>
      </div>
    </div>
    

    <!-- Carousel-->
    <div class="carousel-container">
      <div id="myCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="listing-product-carousel/slide-01.jpg" class="d-block w-100" alt="Trend 1">
          </div>
          <div class="carousel-item">
            <img src="listing-product-carousel/slide-02.jpg" class="d-block w-100" alt="Trend 2">
          </div>
          <div class="carousel-item">
            <img src="listing-product-carousel/slide-03.jpg" class="d-block w-100" alt="Trend 3">
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#myCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#myCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
        </button>
      </div>
    </div>

    <!-- Flash Deals Section -->
  <section class="flash-deals">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="text-danger fw-bold">ðŸ”¥ Flash Deals</h4>
        <a href="#">VIEW MORE â€º</a>
      </div>
      <div class="flash-deals-grid">
        <!-- Flash Deal Items -->
        <div class="deal-item">
          <img src="image/product7.jpg" alt="Flash Deal 1" />
          <div class="price">â‚±999</div>
          <div class="discount">50% OFF</div>
          <div class="countdown">Ends in 02:30:45</div>
        </div>
        <div class="deal-item">
          <img src="image/product8.jpg" alt="Flash Deal 2" />
          <div class="price">â‚±799</div>
          <div class="discount">30% OFF</div>
          <div class="countdown">Ends in 01:15:20</div>
        </div>
        <div class="deal-item">
          <img src="image/product9.jpg" alt="Flash Deal 3" />
          <div class="price">â‚±499</div>
          <div class="discount">60% OFF</div>
          <div class="countdown">Ends in 04:45:10</div>
        </div>
        <div class="deal-item">
          <img src="image/product10.jpg" alt="Flash Deal 4" />
          <div class="price">â‚±1299</div>
          <div class="discount">20% OFF</div>
          <div class="countdown">Ends in 00:59:59</div>
        </div>
        <div class="deal-item">
          <img src="image/product11.jpg" alt="Flash Deal 5" />
          <div class="price">â‚±699</div>
          <div class="discount">45% OFF</div>
          <div class="countdown">Ends in 03:30:00</div>
        </div>
        <div class="deal-item">
          <img src="image/product12.jpg" alt="Flash Deal 6" />
          <div class="price">â‚±599</div>
          <div class="discount">35% OFF</div>
          <div class="countdown">Ends in 01:00:00</div>
        </div>
      </div>
    </div>
  </section>

  <!--Category Navigation -->
  <nav class="category-nav">
    <div class="nav-links">
    <a href="women.html">WOMEN</a>
    <a href="men.html">MEN</a>
    <a href="footwear.html">FOOTWEAR</a>
    <a href="jewelries.html">JEWELRIES</a>
    <a href="beauty.html">BEAUTY & PERSONAL CARE</a>
    <a href="books.html">BOOKS</a>
    <a href="e-gadgets.html">ELECTRONIC GADGETS</a>
  </div>
  
  <div class="actions">
    <button id="filterBtn" class="filter-button" aria-label="Open filter">
      <span class="material-symbols-outlined">filter_list</span>
    </button>

  </div>

  </nav>  
  <!--  Product Section -->
  <main class="container category-section">
    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-6 g-4">
     <!-- Repeatable Product Card -->
     <div class="col">
      <div class="card product-card position-relative">
        <img src="image/product1.jpg" class="card-img-top" alt="Product">
        <div class="card-body text-center">
          <h6 class="card-title mb-1">The Silent Patient</h6>
          <p class="card-text text-muted" style="padding-bottom: 50px;">â‚±336</p>
        </div>
        <button class="btn btn-sm btn-dark add-to-cart position-absolute bottom-0 start-50 translate-middle-x mb-2"
          data-id="1"
          data-name="The Silent Patient"
          data-price="336"
          data-image="image/product1.jpg">
          Add to Cart
        </button>
      </div>
    </div>

      <div class="col">
        <div class="card product-card position-relative">
          <img src="image/product2.jpg" class="card-img-top" alt="Product">
          <div class="card-body text-center">
            <h6 class="card-title mb-1">Blue Polo Shirt</h6>
            <p class="card-text text-muted" style="padding-bottom: 50px;">â‚±336</p>
          </div>
          <button class="btn btn-sm btn-dark add-to-cart position-absolute bottom-0 start-50 translate-middle-x mb-2"
            data-id="2"
            data-name="Blue Polo Shirt"
            data-price="336"
            data-image="image/product2.jpg">
            Add to Cart
          </button>
        </div>
      </div>

      <div class="col">
        <div class="card product-card position-relative">
          <img src="image/product3.jpg" class="card-img-top" alt="Product">
          <div class="card-body text-center">
            <h6 class="card-title mb-1">Black Boots</h6>
            <p class="card-text text-muted" style="padding-bottom: 50px;">â‚±402</p>
          </div>
          <button class="btn btn-sm btn-dark add-to-cart position-absolute bottom-0 start-50 translate-middle-x mb-2"
            data-id="3"
            data-name="Black Boots"
            data-price="402"
            data-image="image/product3.jpg">
            Add to Cart
          </button>
        </div>
      </div>

      <div class="col">
        <div class="card product-card position-relative">
          <img src="image/product4.jpg" class="card-img-top" alt="Product">
          <div class="card-body text-center">
            <h6 class="card-title mb-1">Gold Necklace</h6>
            <p class="card-text text-muted" style="padding-bottom: 50px;">â‚±379</p>
          </div>
          <button class="btn btn-sm btn-dark add-to-cart position-absolute bottom-0 start-50 translate-middle-x mb-2"
            data-id="4"
            data-name="Gold Necklace"
            data-price="379"
            data-image="image/product4.jpg">
            Add to Cart
          </button>
        </div>
      </div>

      <div class="col">
        <div class="card product-card position-relative">
          <img src="image/product5.jpg" class="card-img-top" alt="Product">
          <div class="card-body text-center">
            <h6 class="card-title mb-1">Headphones</h6>
            <p class="card-text text-muted" style="padding-bottom: 50px;">â‚±235</p>
          </div>
          <button class="btn btn-sm btn-dark add-to-cart position-absolute bottom-0 start-50 translate-middle-x mb-2"
            data-id="5"
            data-name="Heaphones"
            data-price="235"
            data-image="image/product5.jpg">
            Add to Cart
          </button>
        </div>
      </div>

      <div class="col">
        <div class="card product-card position-relative">
          <img src="image/product6.jpg" class="card-img-top" alt="Product">
          <div class="card-body text-center">
            <h6 class="card-title mb-1">Lash Mascara</h6>
            <p class="card-text text-muted" style="padding-bottom: 50px;">â‚±179</p>
          </div>
          <button class="btn btn-sm btn-dark add-to-cart position-absolute bottom-0 start-50 translate-middle-x mb-2"
            data-id="6"
            data-name="Lash Mascara"
            data-price="179"
            data-image="image/product6.jpg">
            Add to Cart
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-left">
      <div><a href="about_us.html">ABOUT US</a></div>
      <div><a href="contact.html">CONTACT US</a></div>
    </div>
    <div class="footer-center">
      2025 TRENDORA. <br> All rights reserved.
    </div>
    <div class="footer-right">
      <span>FOLLOW US</span>
      <div class="icons">
        <span><i class="fab fa-facebook-f"></i></span>
        <span><i class="fab fa-instagram"></i></span>
        <span><i class="fab fa-x-twitter"></i></span>
      </div>      
    </div>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Placeholder switching
      const phrases = [
        "Jeans For Teens",
        "Stylish Tops",
        "Trendy Accessories",
        "Affordable Fashion",
        "Best Deals Today"
      ];
      let index = 0;
      const input = document.getElementById("searchInput");
      setInterval(() => {
        if (input) {
          index = (index + 1) % phrases.length;
          input.placeholder = phrases[index];
        }
      }, 2000);
    
      // Cart Overlay Elements
      const cartIcon = document.getElementById("cartIcon");
      const cartOverlay = document.getElementById("cartOverlay");
      const closeCart = document.getElementById("closeCart");
    
      // Open cart and load items
      if (cartIcon && cartOverlay && closeCart) {
        cartIcon.addEventListener("click", () => {
          cartOverlay.classList.add("active"); // Add 'active' class to show overlay
          loadCartOverlay(); // Load items dynamically into the cart
        });
    
        closeCart.addEventListener("click", () => {
          cartOverlay.classList.remove("active");  // Remove 'active' class to hide overlay
        });
      }
    
      // Countdown Timer
      function updateCountdowns() {
        const countdowns = document.querySelectorAll('.countdown');
        countdowns.forEach(el => {
          const endTime = new Date(el.getAttribute('data-end'));
          const now = new Date();
          const diff = endTime - now;
    
          if (diff <= 0) {
            el.textContent = "Expired";
            return;
          }
    
          const hours = String(Math.floor(diff / (1000 * 60 * 60))).padStart(2, '0');
          const minutes = String(Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))).padStart(2, '0');
          const seconds = String(Math.floor((diff % (1000 * 60)) / 1000)).padStart(2, '0');
    
          el.textContent = `Ends in ${hours}:${minutes}:${seconds}`;
        });
      }
      setInterval(updateCountdowns, 1000);
      updateCountdowns();
    
      // Add to Cart Button Handling
      document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', (e) => {
          e.preventDefault();
          
           const id = button.dataset.id;
           const name = button.dataset.name;
           const price = button.dataset.price;
           const image = button.dataset.image;
          
          const productData = { id, name, price, image };
          
          console.log("Adding to cart:", productData);  // ðŸ” Check the actual data
          fetch('add_to_cart.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(productData)
          })
          .then(response => response.text()) // Get raw text first
          .then(text => {
            console.log("Raw response:", text); // Debug output
            try {
              const data = JSON.parse(text);
              if (data.success) {
                const cartCountElement = document.querySelector('#cartIcon .cart-count');
                if (cartCountElement) {
                  cartCountElement.textContent = data.count;
                }
                alert(`${productData.name} added to cart!`);
              } else {
                alert('Failed to add to cart: ' + (data.message || 'Unknown error'));
              }
            } catch (e) {
              console.error('âŒ JSON Parse Error:', e, '\nRaw text was:', text);
              alert("Error: Invalid response from server.");
            }
          })
          .catch(error => console.error('Add to cart error:', error));
        });
      });
    
function loadCartOverlay() {
  const cartItemsContainer = document.getElementById("cartItemsContainer");
  cartItemsContainer.innerHTML = '';

  fetch('get_cart.php')
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById('cartItemsContainer');
      const totalDisplay = document.querySelector('.text-end h4');
      tbody.innerHTML = '';
      let grandTotal = 0;

      if (data.success && data.items.length > 0) {
        data.items.forEach((item, index) => {
          const total = item.product_price * item.quantity;
          grandTotal += total;

          const row = document.createElement('tr');
          row.innerHTML = `
            <td><input type="checkbox" class="itemCheckbox" data-index="${index}" /></td>
           <td class="d-flex align-items-center gap-2">
              <img src="https://trendora.fwh.is/image/${item.product_image}" alt="${item.product_name}" style="width: 50px;" onerror="this.onerror=null; this.src='https://trendora.fwh.is/image/default.jpg';">
              <span>${item.product_name}</span>
            </td>
            <td>${item.quantity}</td>
            <td>â‚±${(total).toFixed(2)}</td>
            <td><button class="btn btn-danger btn-sm remove-btn" data-id="${item.product_id}">Remove</button></td>
          `;
          tbody.appendChild(row);
        });

        totalDisplay.textContent = `Total: â‚±${grandTotal.toFixed(2)}`;

        // Attach remove event after rendering all rows
        document.querySelectorAll('.remove-btn').forEach(button => {
          button.addEventListener('click', () => {
            const productId = button.getAttribute('data-id');
            removeItem(productId);
          });
        });

      } else {
        tbody.innerHTML = '<tr><td colspan="5">Your cart is empty.</td></tr>';
        totalDisplay.textContent = 'Total: â‚±0.00';
      }

      setupCheckboxLogic();
    })
    .catch(err => {
      console.error('Failed to load cart items:', err);
      console.log("Image Path: ", item.product_image);
    });
}


function removeItem(productId) {
  fetch('remove_from_cart.php', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: `product_id=${encodeURIComponent(productId)}`
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      loadCartOverlay(); // Reload cart UI after removal
    } else {
      alert('Failed to remove item: ' + (data.error || 'Unknown error'));
    }
  })
  .catch(err => {
    console.error('Error removing item:', err);
  });
}

      // Checkbox select all logic
      function setupCheckboxLogic() {
        const selectAllCheckbox = document.getElementById('selectAllCheckbox');
        const itemCheckboxes = document.querySelectorAll('.itemCheckbox');
    
        if (selectAllCheckbox) {
          selectAllCheckbox.addEventListener('change', () => {
            itemCheckboxes.forEach(cb => cb.checked = selectAllCheckbox.checked);
          });
    
          itemCheckboxes.forEach(cb => {
            cb.addEventListener('change', () => {
              const allChecked = Array.from(itemCheckboxes).every(c => c.checked);
              selectAllCheckbox.checked = allChecked;
            });
          });
        }
      }
    });
    </script>    
<script>
    document.getElementById("logout-link").addEventListener("click", function (event) {
        event.preventDefault(); // Prevent default anchor behavior
        if (confirm("Are you sure you want to logout?")) {
            window.location.href = "login.html"; // Redirect to login page (or wherever you want)
        }
    });
</script>
</body>
</html>